{{"// Code generated by boxrecordc, DO NOT EDIT."}}

package {{ .Package }}

import (
	"context"
	"fmt"
	"testing"
	"github.com/stretchr/testify/require"
	"github.com/lomik/go-tnt"
)

func Test{{.BoxName}}(t *testing.T) {
	connector := tnt.New("localhost:10000", &tnt.Options{})
	conn, err := connector.Connect()
	require.NoError(t, err)

	defer conn.Close()
	recFields := &{{$.BoxName}}Fields{}
	record, err := Create(context.TODO(), conn, recFields)
	require.NoError(t, err)
	fmt.Printf("record %s\n", record)

	// todo
	// record.SetF3(1)
	// err = record.Update(context.TODO(), conn)
	// require.NoError(t, err)

	selectedRecord, err := SelectBy{{$.PrimaryIndex.Name}}(context.TODO(), conn, record.{{$.PrimaryIndex.Name}}Key())
	require.NoError(t, err)
	fmt.Printf("selected %s\n", selectedRecord)
	fmt.Printf("updated  %s\n", record)
	require.True(t, selectedRecord.Equals(record))

//	record1, err := Create(context.TODO(), conn, &BoxTest1IndexedFields{0, 1, 0, 0})
//	require.NoError(t, err)
//	fmt.Printf("record1 %s\n", record1)
//
//	record2, err := Create(context.TODO(), conn, &BoxTest1IndexedFields{0, 2, 0, 0})
//	require.NoError(t, err)
//	fmt.Printf("record2 %s\n", record2)
//
	records, err := SelectMultiBy{{$.PrimaryIndex.Name}}(context.TODO(), conn, []*{{$.PrimaryIndex.Name}}Key{record.{{$.PrimaryIndex.Name}}Key(), record.{{$.PrimaryIndex.Name}}Key()})
	require.Len(t, records, 2)

	require.True(t, record.Equals(records[0]))
	require.True(t, record.Equals(records[1]))

	err = record.Delete(context.TODO(), conn)
	require.NoError(t, err)

	selectedRecord, err = SelectBy{{$.PrimaryIndex.Name}}(context.TODO(), conn, record.{{$.PrimaryIndex.Name}}Key())
	require.Error(t, err)
	require.Nil(t, selectedRecord)

}

